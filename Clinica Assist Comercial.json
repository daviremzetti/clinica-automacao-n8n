{
  "name": "Clinica Assist Comercial",
  "nodes": [
    {
      "parameters": {
        "content": "## Informa√ß√µes\n",
        "height": 580,
        "width": 780,
        "color": 2
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -1424,
        -48
      ],
      "typeVersion": 1,
      "id": "6e9f3816-77bb-468c-bcb2-79f7dfdedb58",
      "name": "Sticky Note8"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "INSERT INTO conversa_stand_by (contato, hora_ultima_conversa, finalizada)\nVALUES ($1, '{{$now}}', false)\nON CONFLICT (contato) DO UPDATE SET\n  hora_ultima_conversa = '{{ $now }}',\n  finalizada = false;\n",
        "options": {
          "queryReplacement": "={{ [$('Chamada').item.json.numero] }}"
        }
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        1504,
        -304
      ],
      "id": "ef765ee4-1a06-4b40-9499-38c839b3186f",
      "name": "Salva conversa stand by",
      "credentials": {
        "postgres": {
          "id": "arYacY27pDiHcs5s",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=<CLIENTE>\n{{ $('Assistente comercial2').item.json.output }}\n</CLIENTE>",
        "options": {
          "systemMessage": "=# IDENTIDADE\nVoc√™ √© especialista em identificar no contexto da conversa com o cliente se o atendimento encerrou ou n√£o.\n\n# FUN√á√ÉO\nA sua fun√ß√£o √© classificar a situa√ß√£o do atendimento em **2 categorias**:\n\nClassifique a situa√ß√£o do atendimento em apenas uma das categorias abaixo:\n<CATEGORIAS> \n- **\"encerrado\"** ‚Üí Quando a conversa j√° foi conclu√≠da e n√£o requer nova resposta do cliente. \n- **\"nao_encerrado\"** ‚Üí Quando ainda pode haver continuidade ou expectativa de resposta do cliente. \n</CATEGORIAS>\n\n# OUTPUT\nN√£o retorne nenhuma outra informa√ß√£o, apenas a situa√ß√£o do atendimento.\nVoc√™ sempre ir√° responder usando o formato JSON contendo uma √∫nica *chave \"atendimento\"*.\n\n<EXEMPLO>\n{\"filtro\":\"encerrado\"}\n</EXEMPLO>\n"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.9,
      "position": [
        1008,
        -448
      ],
      "id": "3bb5aef2-197f-41de-b2fa-c050704d9d33",
      "name": "Identifica encerramento do atendimento"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "2ca064cd-606b-4a35-b98c-0178bcb634d1",
              "leftValue": "={{ $json.output.parseJson().atendimento }}",
              "rightValue": "encerrado",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        1312,
        -448
      ],
      "id": "a7b5336f-8f9d-4a5e-9cb3-9410dadf35fd",
      "name": "Atendimento encerrado?",
      "alwaysOutputData": false
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "b1925383-3822-4fa4-b0e2-a818e17350c9",
              "name": "mensagem",
              "value": "={{ $json.output.split('\\n') }}",
              "type": "array"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -944,
        48
      ],
      "id": "6be5f4ee-4f81-41a3-b8ac-b3f066dde4a2",
      "name": "Edit Fields3"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        -544,
        48
      ],
      "id": "51fb8546-8ce6-44ac-aef1-6aab99e92b92",
      "name": "Loop Over Items"
    },
    {
      "parameters": {
        "amount": 1
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        -336,
        64
      ],
      "id": "0ae5df57-b61a-4906-8e85-51d180792dc2",
      "name": "Wait1",
      "webhookId": "c1780cc8-b690-4aed-95d6-e7dcecef171d"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-4o-mini",
          "mode": "list",
          "cachedResultName": "gpt-4o-mini"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        1008,
        -256
      ],
      "id": "d5ff8eeb-e7ab-421a-8aaf-3a960a473bc3",
      "name": "OpenAI Chat Model1",
      "credentials": {
        "openAiApi": {
          "id": "mh3lGjR5Byg7EG6P",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "fieldToSplitOut": "mensagem",
        "options": {}
      },
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        -768,
        48
      ],
      "id": "9067390a-5c0c-4273-8e75-70ef5da847a7",
      "name": "Split Out"
    },
    {
      "parameters": {
        "content": "## Envia mensagem",
        "height": 580,
        "width": 1012,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -624,
        -48
      ],
      "typeVersion": 1,
      "id": "47876802-48b4-43dd-9585-03cbe89a5216",
      "name": "Sticky Note"
    },
    {
      "parameters": {
        "content": "## Encerra atendimento?\n",
        "height": 456,
        "width": 720,
        "color": 3
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        944,
        -592
      ],
      "typeVersion": 1,
      "id": "c29736e7-ac3e-4058-839f-7edb93a6ddb1",
      "name": "Sticky Note1"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "INSERT INTO conversa_stand_by (contato, hora_ultima_conversa, finalizada)\nVALUES ($1, '{{$now}}', false)\nON CONFLICT (contato) DO UPDATE SET\n  hora_ultima_conversa = '{{ $now }}',\n  finalizada = true;\n",
        "options": {
          "queryReplacement": "={{ [$('Chamada').item.json.numero] }}"
        }
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        1504,
        -560
      ],
      "id": "f992fafd-ce85-4942-bee8-842807a98f55",
      "name": "Salva conversa stand by2",
      "credentials": {
        "postgres": {
          "id": "arYacY27pDiHcs5s",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {},
      "type": "@n8n/n8n-nodes-langchain.toolCalculator",
      "typeVersion": 1,
      "position": [
        -1040,
        304
      ],
      "id": "e30b3504-0c5c-4802-93a2-0cd0c5b9645f",
      "name": "Calculadora"
    },
    {
      "parameters": {},
      "type": "@n8n/n8n-nodes-langchain.toolThink",
      "typeVersion": 1,
      "position": [
        -1136,
        368
      ],
      "id": "6b946dd3-f213-4ed5-af03-22a9f662bed6",
      "name": "Think"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-4.1-mini",
          "mode": "list",
          "cachedResultName": "gpt-4.1-mini"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        -1360,
        240
      ],
      "id": "29320950-1e10-4636-825d-21ef14b57f0f",
      "name": "OpenAI Chat Model",
      "credentials": {
        "openAiApi": {
          "id": "mh3lGjR5Byg7EG6P",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "=context{{ $('Chamada').item.json.numero }}",
        "sessionTTL": 1209600,
        "contextWindowLength": 15
      },
      "type": "@n8n/n8n-nodes-langchain.memoryRedisChat",
      "typeVersion": 1.5,
      "position": [
        -1216,
        272
      ],
      "id": "0f79610d-a593-417f-9cf5-5a882bc7261b",
      "name": "Redis Chat Memory",
      "credentials": {
        "redis": {
          "id": "4Q6dGgHJkdAxYegV",
          "name": "Redis account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "2afdabf0-c79d-4177-b5d8-6744bb3c02a6",
              "name": "mensagem",
              "value": "={{ $('Loop Over Items').item.json.mensagem.replace(/\\n/g, \"\\\\n\") }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -112,
        64
      ],
      "id": "b3c3934c-518c-42b6-9760-f6452e6da3c3",
      "name": "Retira n"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "={{ $('Chat').item.json.url }}/message/sendText/{{ $('Chat').item.json.instancia }}",
        "sendHeaders": true,
        "specifyHeaders": "json",
        "jsonHeaders": "={\"apikey\":\"{{ $('Chat').item.json.apikey }}\"}",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\"number\":\"{{ $('Chat').item.json.numero }}\",\"text\":\"{{ $json.mensagem }}\",\"delay\":6000}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        2160,
        -1152
      ],
      "id": "a7c2730f-e7e5-4301-bbef-57e8f8a76a69",
      "name": "Envia mensagem"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "={{ $('Chamada').item.json.url }}/send/text",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Accept",
              "value": "application/json"
            },
            {
              "name": "token",
              "value": "={{ $('Chamada').item.json.token }}"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "number",
              "value": "={{ $('Chamada').item.json.numero.replaceAll(' ','').replaceAll('-','').replaceAll('+','') }}"
            },
            {
              "name": "text",
              "value": "={{ $json.mensagem }}"
            },
            {
              "name": "delay",
              "value": "5000"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        80,
        64
      ],
      "id": "5f6560e7-e30a-4270-a150-8edd7d862146",
      "name": "Envia mensagem1"
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "=context{{ $('Chamada').item.json.numero }}",
        "sessionTTL": 1209600,
        "contextWindowLength": 15
      },
      "type": "@n8n/n8n-nodes-langchain.memoryRedisChat",
      "typeVersion": 1.5,
      "position": [
        1152,
        -240
      ],
      "id": "4e2a7bf6-faec-4ede-b6d8-ca2ba28d2c41",
      "name": "Redis Chat Memory2",
      "credentials": {
        "redis": {
          "id": "4Q6dGgHJkdAxYegV",
          "name": "Redis account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "8e6d224f-2271-41f7-ac3f-275b38cd2bc0",
              "name": "dados_consulta",
              "value": "nome do cliente",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1248,
        1104
      ],
      "id": "d7fc00af-fae3-48e1-b35b-88476e000c4b",
      "name": "data da consulta"
    },
    {
      "parameters": {
        "aggregate": "aggregateAllItemData",
        "options": {}
      },
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        -160,
        -192
      ],
      "id": "e8aa3bc2-c15d-4ccc-a218-f3184b851d46",
      "name": "Aggregate"
    },
    {
      "parameters": {
        "inputSource": "passthrough"
      },
      "type": "n8n-nodes-base.executeWorkflowTrigger",
      "typeVersion": 1.1,
      "position": [
        -1536,
        48
      ],
      "id": "28208f2a-210b-4247-a04d-664da3c9ca38",
      "name": "Chamada"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=<CLIENTE>\n{{ $json.mensagens }}\n</CLIENTE>\n\n<SAUDACAO>\nsaudacao: {{ (() => {\n    const hora = new Date().toLocaleString('pt-BR', { timeZone: 'America/Sao_Paulo', hour: 'numeric' });\n    let saudacao = '';\n\n    if (hora >= 3 && hora < 12) {\n        saudacao = 'Bom dia';\n    } else if (hora >= 12 && hora < 19) {\n        saudacao = 'Boa tarde';\n    } else {\n        saudacao = 'Boa noite';\n    }\n\n    return saudacao;\n})() }}\n</SAUDACAO>",
        "options": {
          "systemMessage": "=# üéØ MISS√ÉO DO AGENTE\nVoc√™ √© um agente de IA da **Cl√≠nica Vida Plena**, respons√°vel por atender pacientes via WhatsApp.\\n\nSeu objetivo √© **tirar d√∫vidas** e **conduzir o paciente at√© o agendamento**, fazendo **uma pergunta por vez**, de forma **humanizada, clara e acolhedora**.\\n\n**Nunca** avance para hor√°rios antes de coletar todos os dados obrigat√≥rios.\n\n---\n\n# üó£Ô∏è ESTILO E TOM DE VOZ\n- Linguagem natural, educada e acolhedora.  \n- Frases curtas e objetivas.  \n- Emojis leves permitidos (üëãüòäü©∫üíö).  \n- **Apenas uma pergunta por vez.**  \n- Sempre responder d√∫vidas e retornar ao fluxo.  \n- Evitar linguagem t√©cnica.\n\n---\n\n# üß† CONTEXTO ATUAL DA CONVERSA (JSON)\nUse APENAS estes dados para decidir o pr√≥ximo passo:\\n\nnome: {{ $('Chamada').item.json.nome }}\ncpf: {{ $('Chamada').item.json.cpf }}\nnascimento: {{ $('Chamada').item.json.nascimento }}\npossui_cadastro: {{ $('Chamada').item.json.possui_cadastro }}\nespecialidade: {{ $('Chamada').item.json.especialidade }}\nplano_saude: {{ $('Chamada').item.json.plano_saude }}\nmedico_preferencia: {{ $('Chamada').item.json.medico_preferencia }}\n\nO valor `null` significa que o paciente **ainda n√£o informou** esse dado.\\n\n**Use apenas os valores do JSON para decidir o pr√≥ximo passo.**  \n**Nunca use mem√≥ria ou hist√≥rico da conversa.**\n\n---\n\n# üß± ORDEM OBRIGAT√ìRIA (HARD-STOP)\nO agente s√≥ pode avan√ßar seguindo exatamente esta ordem:\n\n1Ô∏è‚É£ Apresenta√ß√£o + verificar se j√° √© paciente  \n2Ô∏è‚É£ Especialidade  \n3Ô∏è‚É£ Tipo de atendimento (plano / particular)  \n4Ô∏è‚É£ Prefer√™ncia por m√©dico  \n5Ô∏è‚É£ Nome  \n6Ô∏è‚É£ CPF  \n7Ô∏è‚É£ Nascimento  \n8Ô∏è‚É£ Encaminhar para o setor de agenda  \n9Ô∏è‚É£ Confirma√ß√£o final  \n\nüö´ **PROIBIDO** oferecer hor√°rios antes que TODOS ESTES CAMPOS estejam preenchidos:\n- nome  \n- cpf  \n- nascimento  \n- especialidade  \n- plano_saude  \n- medico_preferencia  \n\nSe o paciente pedir hor√°rios antes da hora, responda:  \n\"Claro üòä Eu te mostro sim!\\nAntes, preciso concluir sua identifica√ß√£o. Por favor, me informe seu **[campo que ainda est√° null]**.\"\n\n---\n\n# üö™ 1Ô∏è‚É£ APRESENTA√á√ÉO E VERIFICA√á√ÉO DE CADASTRO\nSe `possui_cadastro` = null:\n\n\"Ol√°! üëã\\nSeja bem-vindo(a) √† **Cl√≠nica Vida Plena**.\\nSou a assistente virtual da cl√≠nica e posso te ajudar com seu agendamento.\\nVoc√™ j√° √© paciente da cl√≠nica ou √© a primeira vez que entra em contato?\"\n\n- Se disser que **j√° √© paciente** ‚Üí possui_cadastro = \"sim\"  \n- Se disser que √© **a primeira vez** ‚Üí possui_cadastro = \"nao\"\n\n---\n\n# üë®‚Äç‚öïÔ∏è 2Ô∏è‚É£ FLUXO PACIENTE EXISTENTE (possui_cadastro = \"sim\")\nPergunte somente os campos que estiverem **null**, sempre na ordem abaixo:\n\n1Ô∏è‚É£ cpf  \n\"Por favor, me informe seu CPF.\"  \n\n2Ô∏è‚É£ nome  \n\"Obrigado! Agora me diga seu nome completo, por favor.\"  \n\n3Ô∏è‚É£ nascimento  \n\"Para confirmar sua identifica√ß√£o, qual √© a sua data de nascimento?\"  \n\n4Ô∏è‚É£ especialidade  \n\"Certo üòä Qual especialidade m√©dica voc√™ deseja marcar?\"  \n\n5Ô∏è‚É£ plano_saude  \n\"A consulta ser√° particular ou pelo plano de sa√∫de?\"  \n\n6Ô∏è‚É£ medico_preferencia  \n\"Voc√™ tem prefer√™ncia por algum m√©dico do nosso corpo cl√≠nico?\"  \n\n‚û°Ô∏è Quando todos os dados estiverem preenchidos:  \n\"Perfeito!\\nVou te encaminhar agora para o setor respons√°vel por verificar os hor√°rios dispon√≠veis.\\nUm instante ‚è≥\"\n\n---\n\n# üÜï 3Ô∏è‚É£ FLUXO NOVO PACIENTE (possui_cadastro = \"nao\")\nPergunte somente os campos que estiverem **null**, na ordem:\n\n1Ô∏è‚É£ especialidade  \n\"Perfeito üòä Com qual especialidade m√©dica voc√™ deseja marcar?\"\n\n2Ô∏è‚É£ plano_saude  \n\"A consulta ser√° particular ou pelo plano de sa√∫de?\"\n\n3Ô∏è‚É£ medico_preferencia  \n\"Voc√™ tem prefer√™ncia por algum m√©dico da nossa equipe?\"\n\n4Ô∏è‚É£ nome  \n\"Perfeito! Agora, por favor, me informe seu nome completo.\"\n\n5Ô∏è‚É£ cpf  \n\"Obrigado! Agora me informe seu CPF, por favor.\"\n\n6Ô∏è‚É£ nascimento  \n\"E qual √© a sua data de nascimento?\"\n\n‚û°Ô∏è Quando todos os dados estiverem preenchidos:  \n\"√ìtimo!\\nVou te encaminhar agora para o setor respons√°vel por verificar os hor√°rios dispon√≠veis.\\nUm instante ‚è≥\"\n\n---\n\n# üí¨ D√öVIDAS DO PACIENTE\nSe o paciente perguntar qualquer coisa fora do fluxo:\n\n1Ô∏è‚É£ Responda em at√© **1 frase**.  \n2Ô∏è‚É£ Retorne imediatamente ao **pr√≥ximo campo null**.  \n\nExemplo:  \nPaciente: \"Voc√™s fazem exames?\"  \nIA: \"Fazemos sim üòä conforme solicita√ß√£o m√©dica.\\nAgora, por favor, me informe seu **[campo null]**.\"\n\n---\n\n# ‚öôÔ∏è REGRAS GERAIS\n- Sempre seguir o JSON.  \n- Nunca pular etapas.  \n- Nunca oferecer hor√°rios antes da hora.  \n- Nunca usar hist√≥rico ou mem√≥ria, apenas os campos do JSON.  \n- Quando finalizar o atendimento:  \n  \"A equipe respons√°vel verificar√° agora os hor√°rios e retornar√° com a confirma√ß√£o da consulta, incluindo **data, hor√°rio, profissional e endere√ßo da cl√≠nica**.\"  "
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.8,
      "position": [
        -1312,
        48
      ],
      "id": "7fd5d17d-9b32-4c7b-97cb-45fb135ed1cf",
      "name": "Assistente comercial"
    },
    {
      "parameters": {
        "content": "## Recep√ß√£o ",
        "height": 420,
        "width": 708
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        176,
        -544
      ],
      "typeVersion": 1,
      "id": "f79a2944-638d-48d5-865a-d609bf13f2e6",
      "name": "Sticky Note2"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Identifique qual setor o atendimento deve ser transferido\n\n<CLIENTE>\n{{ $('Chamada').item.json.mensagens }}\n</CLIENTE>",
        "options": {
          "systemMessage": "=Voc√™ √© o **Agente Classificador da Cl√≠nica Vida Plena**.\n\nSua miss√£o √© analisar:\n1) A √öLTIMA mensagem enviada pelo paciente.\n2) Os valores dos campos abaixo:\n\nnome: {{ $('Chamada').item.json.nome }}\ncpf: {{ $('Chamada').item.json.cpf }}\nnascimento: {{ $('Chamada').item.json.nascimento }}\nespecialidade: {{ $('Chamada').item.json.especialidade }}\nplano_saude: {{ $('Chamada').item.json.plano_saude }}\nmedico_preferencia: {{ $('Chamada').item.json.medico_preferencia }}\n\n---\n\n# üéØ REGRAS DE CLASSIFICA√á√ÉO\n\n## ‚úÖ 1) checa_calendario\nRetorne:\n{\n  \"setor\": \"checa_calendario\"\n}\n**Somente se TODOS os campos abaixo N√ÉO forem null:**\n- nome\n- cpf\n- nascimento\n- especialidade\n- plano_saude\n- medico_preferencia\n\nMesmo que o paciente pergunte outra coisa, se todos estiverem preenchidos ‚Üí este √© o setor correto.\n\n---\n\n## ‚ùå 2) cancelamento\nRetorne:\n{\n  \"setor\": \"cancelamento\"\n}\nSomente se o paciente expressar **claramente** inten√ß√£o de:\n- cancelar\n- desmarcar\n- remover agendamento\n\n---\n\n## ‚ö†Ô∏è 3) atendimento_geral\nRetorne:\n{\n  \"setor\": \"atendimento_geral\"\n}\nEm qualquer um destes casos:\n- Ainda existe **qualquer** campo null\n- O paciente faz perguntas gerais\n- O paciente tenta agendar antes dos campos obrigat√≥rios\n- A mensagem √© irrelevante ou amb√≠gua\n\n---\n\n# üö® REGRAS CR√çTICAS\n- Nunca invente campos.\n- Nunca use hist√≥rico, apenas os valores recebidos.\n- Nunca explique sua resposta.\n- Nunca envie texto adicional.\n\nA resposta DEVE SER APENAS:\n\n{\n  \"setor\": \"xxx\"\n}"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.7,
      "position": [
        304,
        -480
      ],
      "id": "10fa03eb-3be0-4813-91c0-9252f05c339c",
      "name": "Informa√ß√µes ou agendamentos"
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "=context{{ $('Chamada').item.json.numero }}",
        "sessionTTL": 1209600,
        "contextWindowLength": 25
      },
      "type": "@n8n/n8n-nodes-langchain.memoryRedisChat",
      "typeVersion": 1.5,
      "position": [
        496,
        -272
      ],
      "id": "97579917-2e7f-42f2-8770-414860815be4",
      "name": "Redis Chat Memory5",
      "credentials": {
        "redis": {
          "id": "4Q6dGgHJkdAxYegV",
          "name": "Redis account"
        }
      }
    },
    {
      "parameters": {
        "options": {
          "temperature": 0.1,
          "topP": 0.1
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatDeepSeek",
      "typeVersion": 1,
      "position": [
        240,
        -288
      ],
      "id": "41b65fe7-1787-443c-bd94-f85890d55590",
      "name": "DeepSeek Chat Model1",
      "credentials": {
        "deepSeekApi": {
          "id": "2fFfirWrLEfRHahC",
          "name": "DeepSeek account"
        }
      }
    },
    {
      "parameters": {
        "operation": "upsert",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "atendimento",
          "mode": "list",
          "cachedResultName": "atendimento"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "contato": "={{ $('Chamada').item.json.numero }}",
            "setor": "={{ $json.output.parseJson().setor }}"
          },
          "matchingColumns": [
            "contato"
          ],
          "schema": [
            {
              "id": "contato",
              "displayName": "contato",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "setor",
              "displayName": "setor",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        656,
        -480
      ],
      "id": "fd951063-d40b-4a43-b1bf-5e48fb340c17",
      "name": "Transfere setor",
      "credentials": {
        "postgres": {
          "id": "arYacY27pDiHcs5s",
          "name": "Postgres account"
        }
      }
    }
  ],
  "pinData": {
    "Chamada": [
      {
        "json": {
          "mensagens": "Bom dia",
          "numero": "554884508723@s.whatsapp.net",
          "url": "https://work-less-ai.uazapi.com",
          "token": "8b4701cb-f821-47f0-9c55-69fbf9069eb0",
          "id": "554891632926:ACFBF7B58ADF21D9C1F0D5C94FF1A52D",
          "especialidade": null,
          "nome": null,
          "medico": null,
          "plano_saude": null,
          "medico_preferencia": null,
          "possui_cadastro": null,
          "nascimento": null,
          "cpf": null
        }
      }
    ]
  },
  "connections": {
    "Identifica encerramento do atendimento": {
      "main": [
        [
          {
            "node": "Atendimento encerrado?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Atendimento encerrado?": {
      "main": [
        [
          {
            "node": "Salva conversa stand by2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Salva conversa stand by",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields3": {
      "main": [
        [
          {
            "node": "Split Out",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items": {
      "main": [
        [
          {
            "node": "Aggregate",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Wait1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait1": {
      "main": [
        [
          {
            "node": "Retira n",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model1": {
      "ai_languageModel": [
        [
          {
            "node": "Identifica encerramento do atendimento",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Split Out": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Calculadora": {
      "ai_tool": [
        [
          {
            "node": "Assistente comercial",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Think": {
      "ai_tool": [
        [
          {
            "node": "Assistente comercial",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "Assistente comercial",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Redis Chat Memory": {
      "ai_memory": [
        [
          {
            "node": "Assistente comercial",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Retira n": {
      "main": [
        [
          {
            "node": "Envia mensagem1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Envia mensagem": {
      "main": [
        []
      ]
    },
    "Envia mensagem1": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Redis Chat Memory2": {
      "ai_memory": [
        [
          {
            "node": "Identifica encerramento do atendimento",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "data da consulta": {
      "main": [
        []
      ]
    },
    "Aggregate": {
      "main": [
        [
          {
            "node": "Informa√ß√µes ou agendamentos",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Salva conversa stand by": {
      "main": [
        []
      ]
    },
    "Salva conversa stand by2": {
      "main": [
        []
      ]
    },
    "Chamada": {
      "main": [
        [
          {
            "node": "Assistente comercial",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Assistente comercial": {
      "main": [
        [
          {
            "node": "Edit Fields3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Redis Chat Memory5": {
      "ai_memory": [
        [
          {
            "node": "Informa√ß√µes ou agendamentos",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "DeepSeek Chat Model1": {
      "ai_languageModel": [
        [
          {
            "node": "Informa√ß√µes ou agendamentos",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Informa√ß√µes ou agendamentos": {
      "main": [
        [
          {
            "node": "Transfere setor",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1",
    "timezone": "America/Sao_Paulo",
    "callerPolicy": "workflowsFromSameOwner"
  },
  "versionId": "0e696dac-4f7e-4c64-8533-04dfb65b8a9a",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "a70a1343a03530a452f4dec61f49dcb55af90d675b64a06d66352538d4bcf3b4"
  },
  "id": "1ucMFbb0NnfMqLwi",
  "tags": []
}